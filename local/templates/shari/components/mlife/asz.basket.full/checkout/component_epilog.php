<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true) die();?><?global $APPLICATION;?><?if($_REQUEST['ajaxrefresh']!=1){?><script>$(document).ready(function(){	$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });	function refreshBasket(){		$.ajax({			url: '<?=$APPLICATION->GetCurPage(false)?>',			data: {ajaxrefresh:'1'},			dataType : "html",			success: function (data, textStatus) {				$('.mlfSmallcart1').trigger('refreshBasket');				$('.basketWrap').html(data);				$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });			}		});	}		$(document).on('click','.basketItems a.delete',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		$.ajax({			 url: '<?=$APPLICATION->GetCurPage(false)?>',			 data: {ajax:'1',action:'basket_delete', bid: bid},			 dataType : "html",			 success: function (data, textStatus) {				if(data != 'ok'){					$('.preload').remove();					$('body').append('<div id="popup" class="corzMessage"><span class="button b-close"><span>X</span></span><div class="content">'+data+'</div></div>');					$('.corzMessage').bPopup({					easing: 'easeOutBack', //uses jQuery easing plugin						speed: 450,						transition: 'slideDown',						onClose: function() { $('#popup').remove(); }					});				}else{					refreshBasket();				}				$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });			}		});	});	$(document).on('click','.basketItems a.minus, .basketItems a.update, .basketItems a.plus',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		var pid = $(this).attr('data-prod');		if($(this).attr('data-min').length > 0){			var min_quant = parseInt($(this).attr('data-min'));				} else{			var min_quant = 1;					}		var quant = 1;		if($(this).hasClass('minus')){			quant = parseInt($('div#p'+bid+' .quant input').val()) - min_quant;		}else if($(this).hasClass('plus')){			quant = parseInt($('div#p'+bid+' .quant input').val()) + min_quant;		}else if($(this).hasClass('update')){			quant = parseInt($('div#p'+bid+' .quant input').val());		}		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		if(quant==0) {			$.ajax({				 url: '<?=$APPLICATION->GetCurPage(false)?>',				 data: {ajax:'1',action:'basket_delete', bid: bid},				 dataType : "html",				 success: function (data, textStatus) {					if(data != 'ok'){						$('.preload').remove();					}else{						refreshBasket();					}					$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });				}			});		}else{			$.ajax({				 url: '<?=$APPLICATION->GetCurPage(false)?>',				 data: {ajax:'1',action:'basket_update', bid: bid, prodid: pid, quant: quant},				 dataType : "html",				 success: function (data, textStatus) {					if(data != 'ok'){						$('.preload').remove();					}else{						refreshBasket();					}					$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });				}			});		}	});	$(document).on('change','.b-cart__column--quant input[name="quant"]',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		var pid = $(this).attr('data-prod');		if($(this).attr('data-min').length > 0){			var min_quant = parseInt($(this).attr('data-min'));				} else{			var min_quant = 1;					}		var quant = $(this).val();		if(quant < min_quant){			quant = min_quant;		}				$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		if(quant==0) {			$.ajax({				 url: '<?=$APPLICATION->GetCurPage(false)?>',				 data: {ajax:'1',action:'basket_delete', bid: bid},				 dataType : "html",				 success: function (data, textStatus) {					if(data != 'ok'){						$('.preload').remove();					}else{						refreshBasket();					}					$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });				}			});		}else{			$.ajax({				 url: '<?=$APPLICATION->GetCurPage(false)?>',				 data: {ajax:'1',action:'basket_update', bid: bid, prodid: pid, quant: quant},				 dataType : "html",				 success: function (data, textStatus) {					if(data != 'ok'){						$('.preload').remove();					}else{						refreshBasket();					}					$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });				}			});		}	});		$(document).on('click','.deliveryItems .image img',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		$('#DELIVERY_ID').val(bid);		$('#ajaxrefresh').val('1');		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		$.ajax({			 url: '<?=$APPLICATION->GetCurPage(false)?>',			 data: $("#orderForm").serialize(),			 type: "POST",			 dataType : "html",			 success: function (data, textStatus) {				$('.basketWrap').html(data);				$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });			}		});	});		$(document).on('click','.paymentItems .image img',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		$('#PAYMENT_ID').val(bid);		$('#ajaxrefresh').val('1');		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		$.ajax({			 url: '<?=$APPLICATION->GetCurPage(false)?>',			 data: $("#orderForm").serialize(),			 type: "POST",			 dataType : "html",			 success: function (data, textStatus) {				$('.basketWrap').html(data);				$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });			}		});	});		$(document).on('click','.basketWrap .buttons a',function(e){		e.preventDefault();		var bid = $(this).attr('data-id');		$('#ajaxrefresh').val('1');		$('#orderfin').val('1');			$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		$.ajax({			 url: '<?=$APPLICATION->GetCurPage(false)?>',			 data: $("#orderForm").serialize(),			 type: "POST",			 dataType : "html",			 success: function (data, textStatus) {				$('.basketWrap').html(data);				$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });				yaCounter40939409.reachGoal('zakaz'); 				ga ('send', 'event', 'form', 'order')			}		});	});	<?if($arParams["PROP_LOCATION"]){?>	$(document).on('change','#user_<?=$arParams["PROP_LOCATION"]?>',function(e){		e.preventDefault();		$('#ajaxrefresh').val('1');		$('.basketWrap').append('<div class="preload"><div class="load"></div></div>');		$.ajax({			 url: '<?=$APPLICATION->GetCurPage(false)?>',			 data: $("#orderForm").serialize(),			 type: "POST",			 dataType : "html",			 success: function (data, textStatus) {				$('.basketWrap').html(data);				$('input[name=user_PHONE]').inputmask("+7 (999) 999-9999", { "clearIncomplete": true });			}		});	});	<?}?>	});</script><?}?>